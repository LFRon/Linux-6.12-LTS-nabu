From a971de305a5a4984b2424088f0c3c9d321d64f0f Mon Sep 17 00:00:00 2001
From: map220v <map220v300@gmail.com>
Date: Wed, 2 Aug 2023 19:15:53 +0300
Subject: [PATCH 03/19] power: qcom_fg: Add initial pm8150b support

power: qcom_fg: Fix memif address for pm8150b

power: qcom_fg: Fix wrong psy passed to power_supply_put_battery_info()

power: qcom_fg: Add support for temperature data on gen4 fg
---
 drivers/power/supply/qcom_fg.c | 393 +++++++++++++++++++--------------
 1 file changed, 229 insertions(+), 164 deletions(-)

diff --git a/drivers/power/supply/qcom_fg.c b/drivers/power/supply/qcom_fg.c
index 5e887701d4bb..bb8294f4a684 100644
--- a/drivers/power/supply/qcom_fg.c
+++ b/drivers/power/supply/qcom_fg.c
@@ -1338,5 +1338,7 @@ static void qcom_fg_remove(struct platform_device *pdev)
 {
 	struct qcom_fg_chip *chip = platform_get_drvdata(pdev);
 
-	if(chip->sram_wq)
+	power_supply_put_battery_info(chip->batt_psy, chip->batt_info);
+
+	if (chip->sram_wq)
 		destroy_workqueue(chip->sram_wq);
-- 
2.51.0

